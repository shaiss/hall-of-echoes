---
alwaysApply: true
description: TelcoPay project overview and navigation guide - always apply this first
---

# TelcoPay Project Guide

**Master navigation rule for TelcoPay SMS Payment System - Always read this first**

## Project Overview

TelcoPay is an SMS-based payment system demonstrating carrier-backed custodial wallets for feature phone users without app installation.

**Current Status**: **Phase 1 - SMS Gateway + DynamoDB Demo Mode** âœ…

### What Works Now (Phase 1)
- âœ… SMS command processing via AWS Pinpoint simulator numbers
- âœ… User signup with custodial wallets
- âœ… P2P payments between users
- âœ… Merchant payments
- âœ… Balance tracking & transaction history
- âœ… Real-time demo viewer with beautiful CLI
- âœ… API endpoints for wallet queries
- âœ… Demo mode (responses logged, not sent - AWS Sandbox limitation)

### What's Coming (Phase 2+)
- ğŸš€ NEAR blockchain integration
- ğŸ¤– Shade Agent AI reasoning
- ğŸ” TEE-protected key management
- ğŸ« On-chain SBT minting
- ğŸŒ Multi-chain support via Chain Signatures

## Quick Reference

### Essential Commands
```bash
# Run demo viewer (real-time event monitor)
./demo-viewer.sh

# Send test SMS
./send-test-msg.sh --command SIGNUP --originator +14255556001
./send-test-msg.sh --command "PAY 25 +14255556050" --originator +14255556001

# Deploy infrastructure
cd cdk && npm run build && npx cdk deploy TelcoSmsStack --profile shai-sandbox-profile

# Check logs
aws logs tail /aws/lambda/telco-sms-handler --follow --profile shai-sandbox-profile

# Query wallet via API
curl 'https://jz8cqdl5h4.execute-api.us-east-1.amazonaws.com/prod/wallet/%2B14255556001' | jq
```

### AWS Configuration
- **Profile**: `shai-sandbox-profile`
- **Region**: `us-east-1`
- **Account**: `311843862895`
- **Stack**: `TelcoSmsStack`

## Project Structure

```
/
â”œâ”€â”€ README.md                    # Project overview
â”œâ”€â”€ QUICKSTART.md               # 5-minute setup
â”œâ”€â”€ cdk/                        # AWS CDK infrastructure
â”‚   â””â”€â”€ lib/telco-sms-stack.ts # Main stack
â”œâ”€â”€ lambdas/                    # Lambda functions
â”‚   â”œâ”€â”€ sms-handler/           # Process SMS commands
â”‚   â”œâ”€â”€ wallet-service/        # REST API
â”‚   â””â”€â”€ shared/                # Shared utilities
â”œâ”€â”€ cli/                        # CLI tools
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ demo-viewer.ts     # Real-time event viewer
â”‚   â”‚   â”œâ”€â”€ demo-display.ts    # Gum/charm styling
â”‚   â”‚   â””â”€â”€ api-client.ts      # API wrapper
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ docs/                       # Documentation
â”‚   â”œâ”€â”€ demo-viewer.md
â”‚   â”œâ”€â”€ testing-guide.md
â”‚   â””â”€â”€ aws-setup/
â”œâ”€â”€ scripts/                    # Helper scripts
â”œâ”€â”€ demo-viewer.sh             # Demo launcher
â””â”€â”€ send-test-msg.sh           # Test message sender
```

## How to Use Cursor Rules

### For Phase 1 Work (Current)

**Always Available**:
1. **This rule (telcopay-project-guide)** - You're reading it now
2. **[aws-solutions-architect](mdc:.cursor/rules/aws-solutions-architect.mdc)** - AWS architecture guidance
   - Use for: CDK, Lambda, DynamoDB, Pinpoint, SNS, API Gateway
   - Contains TelcoPay-specific patterns
3. **[ui-ux-designer](mdc:.cursor/rules/ui-ux-designer.mdc)** - CLI/Terminal UI design
   - Use for: Demo viewer, gum/charm styling, terminal UX

**Request When Needed**:
- Ask: "Show me NEAR deployment patterns" â†’ loads near-cdk rule
- Ask: "How do NEAR Intents work?" â†’ loads near-ecosystem rule

### For Future Phases

**Phase 2+ Rules (Disabled for Now)**:
- `near-cdk-deployment-strategy` - NEAR node deployment
- `near-ecosystem-architect` - Shade Agents, Intents, Chain Signatures
- `near-ai-*` (5 rules) - AI Cloud, private inference, verification
- `aws-identity-architect` - Cognito, Okta, IAM Identity Center

**To Enable**: Change `alwaysApply: false` to `true` in rule frontmatter when implementing those features.

## Architecture (Phase 1)

```
SMS User (+1425555600X)
    â†“
AWS End User Messaging (Simulator Numbers)
[CLI: pinpoint-sms-voice-v2]
    â†“
SNS Topic (telco-pinpoint-sms)
    â†“
Lambda (telco-sms-handler)
    â”œâ†’ DynamoDB (users, transactions, merchants)
    â””â†’ SMS Response (demo mode - logged only)
    
API Gateway (wallet queries)
    â†“
Lambda (telco-wallet-service)
    â†“
DynamoDB (read wallet data)
```

**Important**: AWS Pinpoint SMS is deprecated. TelcoPay uses **AWS End User Messaging** service, but CLI commands still use `pinpoint-sms-voice-v2` namespace. See [aws-end-user-messaging](mdc:.cursor/rules/aws-end-user-messaging.mdc) rule for details.

## Common Tasks & Which Rules to Use

### AWS Infrastructure Work
â†’ Use **aws-solutions-architect** rule (always loaded)
- CDK stack development
- Lambda function creation
- DynamoDB table design
- Pinpoint configuration
- SNS topic setup
- API Gateway endpoints

### CLI Tool Development
â†’ Use **ui-ux-designer** rule (always loaded)
- Demo viewer enhancements
- Terminal UI with gum/charm
- Progress indicators
- Color-coded output
- Interactive prompts

### Testing & Debugging
â†’ Use **aws-solutions-architect** rule
- CloudWatch log analysis
- SNS message testing
- API Gateway testing
- DynamoDB queries
- Lambda troubleshooting

### Documentation
â†’ Reference [docs/README.md](mdc:docs/README.md)
- All docs indexed there
- Testing guide, deployment guide, etc.

## Testing with Simulator Numbers

**Available Range**: +14255556000 to +14255556049 (50 numbers)

**Pre-registered Users** (use these for testing):
- +14255556001 - Alice (100 USDC)
- +14255556050 - Bob (100 USDC)  
- +14255556056 - Carol (100 USDC)

**Test Scenarios**:
```bash
# Signup
./send-test-msg.sh --command SIGNUP --originator +14255556010

# P2P Payment
./send-test-msg.sh --command "PAY 25 +14255556050" --originator +14255556001

# Error (non-existent recipient)
./send-test-msg.sh --command "PAY 10 +14255559999" --originator +14255556001

# Merchant Payment  
./send-test-msg.sh --command "PAY 50 @starbucks" --originator +14255556001
```

## Demo Mode

**Important**: Phase 1 runs in demo mode due to AWS Sandbox limitations.

**What This Means**:
- SMS responses are **logged** (CloudWatch), not sent
- Perfect for development and demos
- Use demo viewer to see "sent" responses in real-time
- Simulator numbers don't receive actual SMS

**To See Responses**:
1. Run demo viewer: `./demo-viewer.sh`
2. Trigger events in another terminal
3. Watch responses appear in demo viewer

## Key Files to Know

### Infrastructure
- [cdk/lib/telco-sms-stack.ts](mdc:cdk/lib/telco-sms-stack.ts) - Main CDK stack

### Lambda Functions
- [lambdas/sms-handler/index.ts](mdc:lambdas/sms-handler/index.ts) - SMS processing entry
- [lambdas/sms-handler/handlers/signup.ts](mdc:lambdas/sms-handler/handlers/signup.ts) - Signup handler
- [lambdas/sms-handler/handlers/p2p-payment.ts](mdc:lambdas/sms-handler/handlers/p2p-payment.ts) - Payment handler

### Shared Code
- [lambdas/shared/types.ts](mdc:lambdas/shared/types.ts) - TypeScript interfaces
- [lambdas/shared/dynamodb-client.ts](mdc:lambdas/shared/dynamodb-client.ts) - DB operations
- [lambdas/shared/pinpoint-client.ts](mdc:lambdas/shared/pinpoint-client.ts) - SMS operations

### CLI Tools
- [cli/src/demo-viewer.ts](mdc:cli/src/demo-viewer.ts) - Real-time event monitor
- [cli/src/demo-display.ts](mdc:cli/src/demo-display.ts) - Gum styling
- [cli/src/api-client.ts](mdc:cli/src/api-client.ts) - API wrapper

## Data Models

### User
```typescript
{
  phone_number: "+14255556001",
  wallet_id: "custodial-wallet-5556001",
  balance: 100,              // USDC (mocked)
  sbt_verified: true,        // Carrier attestation
  created_at: "2025-01-01T12:00:00Z",
  account_type: "user"
}
```

### Transaction
```typescript
{
  tx_id: "tx-a1b2c3d4",
  from_phone: "+14255556001",
  to_phone: "+14255556050",
  amount: 25,
  tx_type: "p2p" | "merchant",
  status: "completed" | "failed",
  timestamp: "2025-01-01T12:00:00Z"
}
```

## When to Ask for Help

**Use aws-solutions-architect rule** (always loaded) when:
- Working with AWS services
- Writing CDK code
- Debugging Lambda functions
- Designing DynamoDB schemas
- Testing with AWS CLI

**Use ui-ux-designer rule** (always loaded) when:
- Building CLI tools
- Adding terminal UI features
- Using gum/charm for styling
- Creating progress indicators
- Designing command structure

**Request NEAR rules** when:
- Planning Phase 2 integration
- Understanding blockchain patterns
- Exploring Shade Agents
- Learning about Intents or Chain Signatures

## Troubleshooting Quick Guide

**Lambda not processing**:
```bash
aws logs tail /aws/lambda/telco-sms-handler --follow --profile shai-sandbox-profile
```

**SNS not routing**:
```bash
aws sns list-subscriptions-by-topic \
  --topic-arn arn:aws:sns:us-east-1:311843862895:telco-pinpoint-sms \
  --profile shai-sandbox-profile
```

**DynamoDB query**:
```bash
aws dynamodb get-item --table-name telco-users \
  --key '{"phone_number":{"S":"+14255556001"}}' \
  --profile shai-sandbox-profile
```

**API not responding**:
```bash
curl 'https://jz8cqdl5h4.execute-api.us-east-1.amazonaws.com/prod/wallet/%2B14255556001' | jq
```

## Documentation

- **Quick Start**: [QUICKSTART.md](mdc:QUICKSTART.md)
- **Project Overview**: [README.md](mdc:README.md)
- **Demo Viewer**: [docs/demo-viewer.md](mdc:docs/demo-viewer.md)
- **Testing Guide**: [docs/testing-guide.md](mdc:docs/testing-guide.md)
- **All Docs**: [docs/README.md](mdc:docs/README.md)

## Phase Roadmap

**Phase 1 (Current)**: SMS + DynamoDB âœ…
- Fully functional demo mode
- 50 simulator numbers for testing
- Real-time demo viewer
- API endpoints working

**Phase 2 (Planned)**: NEAR Integration ğŸš€
- Real NEAR wallets
- On-chain transactions
- SBT verification
- Shade Agent reasoning

**Phase 3 (Planned)**: Advanced Features ğŸ¦
- NEAR AI Cloud integration
- Intent-based settlements
- TEE-protected keys

**Phase 4 (Planned)**: Multi-Chain ğŸŒ
- Chain Signatures
- Cross-chain payments
- Universal abstraction

---

**Remember**: This is Phase 1. Keep it simple. AWS only. No blockchain yet. Focus on SMS â†’ Lambda â†’ DynamoDB flow and making the demo viewer amazing! ğŸ‰
